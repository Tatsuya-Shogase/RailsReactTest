# 【掲示板アプリ】

## 仕様  
・登場人物：投稿者(匿名)、管理者  
・掲示板機能  
　-「カテゴリ」があり、上記ユーザーは「カテゴリ」ごとににテキストを投稿できる  
　-投稿するときは「名前／メールアドレス／件名／本文」が入力可能  
　→ただし、本文以外は任意項目  
　-一度投稿したテキストは編集／削除不可。ただし、投稿者だけ非表示にできる  
　　→非表示になった投稿は全員から見えない  
　-管理者は「カテゴリ」の追加／削除／編集ができる  

・管理機能  
　-管理者のみアクセス可能  
　-「カテゴリ」ごとに投稿数を確認できる  
　-「カテゴリ」の追加／削除／編集は管理機能で実施する  
　-非表示になった投稿も含め、「カテゴリ」ごとにすべての投稿を確認できる  


## DB構成  
### Users  
  username, password, admin  

### Categories  
  name  

### Posts  
  session_id, name, mail, subject, text, visible, category_id(foreign_key)  


## 環境  
RailsをAPIでインストールし、front_endディレクトリにReactをインストールしています。  
DBはsqliteを使用。  
migrationとseedsファイルは作成していますが、念のためsqliteファイルもpushしています。  


## 指摘事項 及び 修正箇所  
### 2020.8.30  
・管理者機能で投稿数が分かるようになっているのですが、管理者が投稿した場合は投稿数の更新がありませんでした。  
　→ 再読み込みすれば更新されました。  
=>投稿時にカテゴリリストを再取得するロジックを追加して対応しました。  

・カテゴリに紐づく投稿データを取得する際にleft joinを使用されているのが気になりました。（パフォーマンス的に）  
=>カテゴリの一覧とカテゴリ別の投稿数のレコードセットを別々に取得し、その結果をマージして返すように変更しました。  

・Reactに一部ハードコード（ログインURL）がありました。  
=>URLをenvから取得するように修正しました。  

・Railsのモデル、コントローラにバリデーションが無く、Reactのフロントにもありませんでした。  
　→そのため、セキュリティリスクHighが1件ありました。（brakemanで確認）  
=>railsとreactの双方にバリデーションを追加しました。なお、brakemanでwarningが発生していないことを確認しています。  

・非表示にした投稿もAPIのレスポンスに載っているため、誰でもブラウザの開発者ツールを使えば全投稿を確認できる状態でした。  
=>投稿の取得時にadminでログインしているかどうかを判断し、非表示分を取得するかしないかを判断する処理を追加しました。  
